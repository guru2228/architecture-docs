# ADR-014: Mandate **On-Behalf-Of (OBO)** via OAuth 2.0 Token Exchange for Agentic Systems in a Zero Trust Architecture

**Status:** Proposed
**Date:** October 28, 2025
**Owners:** Platform Security, Identity & Access, Agent Gateway
**Deciders:** CISO, Chief Architect, AI Security Lead
**Related:** ADR-012 Agent Identity, ADR-013 DPoP, NIST SP 800-207 ZTA

---

## Context

Zero Trust says every request must be explicitly authenticated and authorized, focusing on **users, assets, and resources**—not networks. That scope includes services and agents, not just people. ([NIST Publications][1]) CISA’s Zero Trust guidance and federal ICAM materials also require identity for **non-person entities (NPEs)**, which covers our AI agents. ([CISA][2])

Our agentic workflows are multi-hop: **user → front-end → gateway → agent → downstream APIs/tools → other agents**. If downstream calls are made with generic service tokens (or with the user token but without delegation semantics), we lose: (1) least-privilege per hop, (2) a verifiable **actor chain**, (3) precise auditability and revocation, and (4) the ability to enforce policy that distinguishes *the user* from *the agent acting for that user*.

**OAuth 2.0 Token Exchange (RFC 8693)** standardizes OBO/delegation. It issues a new token that carries an **actor (`act`) claim** and can constrain *who* is permitted to exchange on someone’s behalf via **`may_act`**. Actor chains can be nested to preserve provenance across multiple hops. ([IETF Datatracker][3]) Major identity platforms document OBO specifically for preserving end-user context in downstream API calls. ([Microsoft Learn][4])

---

## Decision

**Adopt OBO via OAuth 2.0 Token Exchange for all agent-initiated downstream calls that rely on end-user context.**

* Use RFC 8693 at our Security Token Service (STS) to exchange inbound user/agent tokens for **downstream, audience-scoped tokens** that include the current **actor** (`act`) and optional nested prior actors. ([IETF Datatracker][3])
* Require upstream tokens intended for exchange to include **`may_act`** so the STS can enforce who is allowed to act on whose behalf. ([docs.pingidentity.com][5])
* Keep Zero Trust alignment: the **Agent Gateway** evaluates *human identity + agent identity + requested resource + session risk* on every hop. ([NIST Publications][1])

---

## Rationale

* **Preserves user context end-to-end.** OBO ensures the downstream token states **who is acting** and **for whom**, enabling policy decisions that differ for user vs. agent. ([Microsoft Learn][4])
* **Standards-based delegation.** RFC 8693 formalizes impersonation/delegation, the **`act`** claim (current actor), nested actor chains, and **`may_act`** authorization for exchange. ([IETF Datatracker][3])
* **Zero Trust fit.** ZTA demands per-request verification and least privilege for **users and workloads**; OBO provides the identity signal and scoping to enforce that. ([NIST Publications][1])
* **Audit & incident response.** Actor chains give tamper-evident provenance for each hop; tokens are audience-limited and short-lived for rapid revocation. (RFC 8693 actor chain semantics.) ([IETF Datatracker][3])
* **Ecosystem support & BCP alignment.** OBO is supported by major providers (e.g., Microsoft Entra, Okta) and aligns with **OAuth 2.0 Security BCP (RFC 9700)**. ([Microsoft Learn][4])

---

## Scope

* **In scope:** Any agent or intermediary calling a protected API/tool **on behalf of a user** (intra- or cross-organization).
* **Out of scope (initial):** Pure service-to-service calls with no user context (use mTLS/DPoP and service identity).

---

## Requirements

1. **STS (Authorization Server)**

   * Implement RFC 8693 token exchange endpoints; accept `subject_token` and optional `actor_token`; issue tokens with **`act`** and enforce **`may_act`**. ([IETF Datatracker][3])
   * Enforce **audience** scoping, short TTLs, and optional depth limits for nested `act`. ([IETF Datatracker][3])
2. **Agent Gateway / Resource Servers**

   * Require downstream tokens to present **actor context** and apply policy using *user claims* + *actor claims* (agent identity), not user claims alone (confused-deputy defense). ([NIST Publications][1])
3. **Clients (Agents / Intermediaries)**

   * When invoking downstream services with user context, use **OBO exchange** rather than forwarding upstream tokens. Follow provider OBO guidance. ([Microsoft Learn][4])
4. **Complementary Sender-Constraint**

   * Bind exchanged tokens to the caller key (DPoP or mTLS) to prevent replay; follow OAuth Security BCP. ([IETF Datatracker][6])

---

## Options Considered

| Option                            | Summary                                            | Pros                                        | Cons                                                                 |
| --------------------------------- | -------------------------------------------------- | ------------------------------------------- | -------------------------------------------------------------------- |
| **A. OBO via RFC 8693 (Chosen)**  | Exchange per hop; `act`/`may_act`; audience-scoped | Standards-based, auditable, least-privilege | Requires STS & gateway enforcement                                   |
| **B. Pass user token downstream** | Reuse original token                               | Fewer moving parts                          | Leaks broad scopes; no actor info; fragile across tenants            |
| **C. Use generic service tokens** | Agent uses its own token only                      | Simple                                      | Loses user context; breaks Zero Trust intent for user-driven actions |

---

## Security Considerations

* **Confused deputy mitigation:** Policies evaluate both **`sub` (user)** and **`act` (current actor)**; nested `act` is informational but provides provenance. ([IETF Datatracker][3])
* **Exchange authorization:** Only entities named in **`may_act`** may exchange; STS must verify and reject unauthorized actors. ([docs.pingidentity.com][5])
* **Replay & theft:** Pair OBO with **DPoP (RFC 9449)** or mTLS so tokens are sender-constrained. ([IETF Datatracker][6])
* **BCP alignment:** Follow **RFC 9700** for modern OAuth hardening (PKCE, strict redirect handling, refresh token hygiene). ([IETF Datatracker][7])

---

## Operational Plan

1. **Enable Token Exchange** at STS; document request/response and error semantics for agents; publish discovery metadata. ([IETF Datatracker][3])
2. **Issue Upstream Tokens with `may_act`** where exchange is expected (per app/agent allow-list). ([docs.pingidentity.com][5])
3. **Gateway Enforcement:** Require actor context for user-scoped downstream calls; deny if missing/mismatched.
4. **Observability:** Log `sub`, top-level `act`, nested `act` depth, audience, decision reason; surface actor chain in audit views.
5. **Hardening:** Require DPoP/mTLS where applicable; short TTLs; audience pinning; continuous evaluation consistent with NIST 800-207. ([IETF Datatracker][6])

---

## Acceptance Criteria / KPIs

* ≥95% of downstream calls that rely on user context use **OBO-exchanged** tokens.
* 0 accepted requests **missing `act`** when user context is required.
* Mean time to revoke an actor (agent) across active sessions **≤5 minutes**.
* All audits show a complete **actor chain** for multi-hop requests.

---

## Example (abbreviated JWT access token)

```json
{
  "iss": "https://sts.example.com",
  "aud": "https://api.downstream.com",
  "sub": "user:alice@example.com",
  "scope": "records:read",
  "act": {
    "client_id": "agent.care-coordinator",
    "sub": "spiffe://prod.example/agents/care-coordinator"
  },
  "exp": 1730131200
}
```

> Notes: `act` identifies the **current actor**; prior actors can be nested for provenance. The exact `act` structure is implementation-defined by the AS; use it to reliably identify the actor. ([IETF Datatracker][3])

---

## References

* **RFC 8693 — OAuth 2.0 Token Exchange** (impersonation/delegation, `act`/`may_act`, actor chain). ([IETF Datatracker][3])
* **Microsoft Entra OBO flow** (downstream API with end-user context). ([Microsoft Learn][4])
* **Okta OBO/Token Exchange guide** (retain user context downstream). ([Okta Developer][8])
* **Ping Identity docs** (`may_act` and delegated token behavior). ([docs.pingidentity.com][5])
* **NIST SP 800-207 — Zero Trust Architecture.** ([NIST Publications][1])
* **CISA ZT Maturity Model v2.0** (identity includes NPE). ([CISA][2])
* **IDManagement.gov Zero Trust & ICAM** (person and non-person entities). ([Idmanagement][9])
* **RFC 9700 — OAuth 2.0 Security Best Current Practice (BCP 240).** ([IETF Datatracker][7])
* **RFC 9449 — DPoP** (sender-constraining exchanged tokens). ([IETF Datatracker][6])

**Bottom line:** In Zero Trust, OBO is the **only safe way** for agents to call downstream services with user context—preserving least privilege, providing an auditable actor chain, and enabling precise policy and revocation at every hop.

[1]: https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-207.pdf?utm_source=chatgpt.com "Zero Trust Architecture - NIST Technical Series Publications"
[2]: https://www.cisa.gov/sites/default/files/2023-04/zero_trust_maturity_model_v2_508.pdf?utm_source=chatgpt.com "Zero Trust Maturity Model Version 2.0"
[3]: https://datatracker.ietf.org/doc/html/rfc8693?utm_source=chatgpt.com "RFC 8693 - OAuth 2.0 Token Exchange"
[4]: https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-on-behalf-of-flow?utm_source=chatgpt.com "Microsoft identity platform and OAuth2.0 On-Behalf-Of flow"
[5]: https://docs.pingidentity.com/pingam/8/oauth2-guide/token-exchange.html?utm_source=chatgpt.com "Token exchange | PingAM"
[6]: https://datatracker.ietf.org/doc/html/rfc9449?utm_source=chatgpt.com "OAuth 2.0 Demonstrating Proof of Possession (DPoP)"
[7]: https://datatracker.ietf.org/doc/rfc9700/?utm_source=chatgpt.com "RFC 9700 - Best Current Practice for OAuth 2.0 Security"
[8]: https://developer.okta.com/docs/guides/set-up-token-exchange/-/main/?utm_source=chatgpt.com "Set up OAuth 2.0 On-Behalf-Of Token Exchange"
[9]: https://www.idmanagement.gov/zero-trust/?utm_source=chatgpt.com "FICAM is the foundation for ZT adoption"
